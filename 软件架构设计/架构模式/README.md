[![javascript](https://user-images.githubusercontent.com/5803001/44412874-859de980-a59c-11e8-8845-eebe9d13d832.jpg)](https://github.com/wx-chevalier/SoftwareEngineering-Series)

# 软件架构模式

软件架构设计的一个核心问题是能否使用重复的架构模式，即能否达到架构级的软件重用。也就是说，能否在不同的软件系统中，使用同一架构。当我们讨论软件架构时，常常会提及软件架构模式（Architectural Pattern）与软件架构风格（Architectural Style）。

软件架构模式往往会用于具体地解决某个具体的重复的架构问题，而架构风格则是对于某个具体的架构设计方案的命名。软件架构风格是描述某一特定应用领域中系统组织方式的惯用模式；架构风格反映了领域中众多系统所共有的结构和语义特性，并指导如何将各个模块和子系统有效组织成一个完整的系统。在笔者的系列文章中，并未硬性分割架构风格与架构模式的差异，而是统一以架构模式来指代。

- 数据流风格：批处理序列，管道/过滤器。
- 调用/返回风格：主程序/子系统，面向对象风格，层次结构。
- 独立构件风格：进程通信，事件系统。
- 虚拟机风格：解释器，基于规则的系统。
- 仓库风格：数据库系统，超文本系统，黑板系统。

软件架构模式的核心就是核心业务逻辑和技术细节的分离与解耦。业务逻辑和技术细节糅杂在一起的情况，所有的代码都写在服务实现里面，将校验、数据转化、逻辑处理、数据存取等不同的操作混杂在一起，再简单的业务，按照上面这种写代码的方式，都会变得复杂，难维护。好的架构风格应该让核心业务逻辑可以反映领域模型和领域应用，可以复用，可以很容易被看懂。让技术细节在辅助实现业务功能的同时，可以被替换。

![](https://i.postimg.cc/Nf3WbWR3/image.png)

# 分层架构

分层是一种常见的根据系统中的角色（职责拆分）和组织代码单元的常规实践。常见的分层结构如下图所示：

![](https://i.postimg.cc/0yV6RdZ0/image.png)

# CQRS

CQS(Command Query Separation，命令查询分离)最早来自于 Betrand Meyer（Eiffel 语言之父，OCP 提出者）提出的概念。其基本思想在于任何一个对象的方法可以分为两大类：

- 命令(Command):不返回任何结果(void)，但会改变对象的状态。
- 查询(Query):返回结果，但是不会改变对象的状态，对系统没有副作用。

![](https://i.postimg.cc/Gm4RtFdQ/image.png)

# 六边形架构

六边形架构是 Alistair Cockburn 在 2005 年提出，解决了传统的分层架构所带来的问题，实际上它也是一种分层架构，只不过不是上下，而是变成了内部和外部（如下图所示）。

![](https://i.postimg.cc/rsZb2H0L/image.png)

六边形架构又称为端口-适配器架构，这个名字更容器理解。六边形架构将系统分为内部（内部六边形）和外部，内部代表了应用的业务逻辑，外部代表应用的驱动逻辑、基础设施或其他应用。适配器分为两种类型（如下图所示），左侧代表 UI 的适配器被称为主动适配器（Driving Adapters），因为是它们发起了对应用的一些操作。而右侧表示和后端工具链接的适配器，被称为被动适配器（Driven Adapters），因为它们只会对主适配器的操作作出响应。

![](https://i.postimg.cc/KjCNNh34/image.png)

# 洋葱圈架构

洋葱架构与六边形架构有着相同的思路，它们都通过编写适配器代码将应用核心从对基础设施的关注中解放出来，避免基础设施代码渗透到应用核心之中。这样应用使用的工具和传达机制都可以轻松地替换，可以一定程度地避免技术、工具或者供应商锁定。不同的是洋葱架构还告诉我们，企业应用中存在着不止两个层次，它在业务逻辑中加入了一些在领域驱动设计的过程中被识别出来的层次（Application，Domain Service，Domain model，Infrastructure 等）。另外，它还有着脱离真实基础设施和传达机制应用仍然可以运行的便利，这样可以使用 Mock 代替它们方便测试。

![](https://i.postimg.cc/Bb860dYT/image.png)

在洋葱架构中，明确规定了依赖的方向：外层依赖内层以及内层对外层无感知。

# 链接

- https://www.infoq.cn/article/m*aORjCU6gQiIbPCVtoK
