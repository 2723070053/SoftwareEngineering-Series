# 数据视图

DDD 分层架构中数据对象转换的过程如下图。

![](https://i.postimg.cc/bvY8dgSZ/image.png)

数据视图应用服务通过数据传输对象（DTO）完成外部数据交换。领域层通过领域对象（DO）作为领域实体和值对象的数据和行为载体。基础层利用持久化对象（PO）完成数据库的交换。DTO 与 VO 通过 Restful 协议实现 JSON 格式和对象转换。

前端应用与应用层之间 DTO 与 DO 的转换发生在用户接口层。如微服务内应用服务需调用外部微服务的应用服务，则 DTO 的组装和 DTO 与 DO 的转换发生在应用层。领域层 DO 与 PO 的转换发生在基础层。

# 聚合根（Aggregate Root）

聚合根（Aggregate Root）是 DDD 中的一个概念，是一种更大范围的封装，把一组有相同生命周期、在业务上不可分隔的实体和值对象放在一起考虑，只有根实体可以对外暴露引用，也是一种内聚性的表现。确定聚合边界要满足固定规则（Invariant），是指在数据变化时必须保持的一致性规则，具体规则如下：

- 根实体具有全局标识，最终负责检查规定规则
- 聚合内的实体具有本地标识，这些标识在 Aggregate 内部才是唯一的
- 外部对象不能引用除根 Entity 之外的任何内部对象
- 只有 Aggregate 的根 Entity 才能直接通过数据库查询获取，其他对象必须通过遍历关联来发现
- Aggegate 内部的对象可以保持对其他 Aggregate 根的引用
- Aggregate 边界内的任何对象修改时，整个 Aggregate 的所有固定规则都必须满足
